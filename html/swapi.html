<!doctype html>
<html lang="en">

<head>
    <!-- Base head metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Page title -->
    <title>MAKING API CALLS FUN!</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- Custom CSS -->
    <link href="css/styles.css" rel="stylesheet" type="text/css" media="all">
    <!-- SWAPI JS FILE -->
    <script type="text/javascript" src="js/swapi.js"></script>
</head>

<body class="text-center">
    <div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
        <header class="masthead mb-auto">
            <div class="inner">
                <h3 class="masthead-brand"><a href="index.html">MAKING API CALLS FUN!</a></h3>
                <nav class="nav nav-masthead justify-content-center">
                    <a class="nav-link active" href="index.html">HOME</a>
                    <a class="nav-link" href="#">Dad Joke's</a>
                    <a class="nav-link" href="#">Wikipedia</a>
                </nav>
            </div>
        </header>

        <main role="main" class="inner cover">
            <h1 class="cover-heading">STAR WARS API</h1>
            <p class="lead">This is an easy to implement js library, that allows you to search for and call against an
                endpoint that searches in a database and returns all the knowledge you could never need to know about
                the Star Wars universe.</p>
            <p class="lead">
                <a href="https://swapi.co/documentation" target="_blank" class="btn btn-lg btn-secondary">Learn more
                    about this API and read up on its documentation here.</a>
            </p>

            <form class="form-inline my-2 my-lg-0">
                <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search"
                    id="peopleSearch">
                <button class="btn btn-secondary my-2 my-sm-0" type="button" onclick="searchForPeople()">Search
                    People</button>
            </form>
            <br>
            <form class="form-inline my-2 my-lg-0">
                <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search"
                    id="shipSearch">
                <button class="btn btn-secondary my-2 my-sm-0" type="button" onclick="searchForShips()">Search Ships</button>
            </form>
        </main>

        <footer class="mastfoot mt-auto">
            <div class="inner">
                <p>Follow me on <a href="https://www.linkedin.com/in/andrewdufresne13/" target="_blank">LinkedIn</a></p>
            </div>
        </footer>
    </div>

    <script>
        var swapiModule = (function () {
            var rootURL = "https://swapi.co/api/";

            function request(url, cb) {
                return fetch(url)
                    .then(function (res) {
                        return res.json();
                    })
                    .then(function (data) {
                        if (typeof cb === "function") {
                            cb(data);
                        }

                        return data;
                    })
                    .catch(function (err) {
                        console.log(err);
                    });
            }

            function getResources(cb) {
                return request(rootURL, cb);
            }

            function singularRequestGenerator(path) {
                return function (id, cb) {
                    return request(rootURL + path + "/" + id + "/", cb);
                };
            }

            function pluralRequestGenerator(path) {
                return function () {

                    let queryObject = undefined;
                    let cb = undefined;

                    if (arguments.length > 1) {
                        queryObject = arguments[0];
                        cb = arguments[1];
                    } else if (arguments[0]) {
                        // If given exactly one argument
                        if (typeof arguments[0] === "function") {
                            cb = arguments[0];
                            queryObject = null;
                        } else {
                            cb = null;
                            queryObject = arguments[0];
                        }
                    }

                    if (queryObject) {
                        let searchParams = new URLSearchParams();
                        for (let key of Object.keys(queryObject)) {
                            let value = queryObject[key];
                            searchParams.append(key, value);
                        }
                        return request(rootURL + path + "/?" + searchParams.toString(), cb);
                    }

                    return request(rootURL + path + "/", cb);

                };
            }

            return {
                getResources: getResources,
                getPerson: singularRequestGenerator("people"),
                getPeople: pluralRequestGenerator("people"),
                getFilm: singularRequestGenerator("films"),
                getFilms: pluralRequestGenerator("films"),
                getPlanet: singularRequestGenerator("planets"),
                getPlanets: pluralRequestGenerator("planets"),
                getSpecies: singularRequestGenerator("species"),
                getAllSpecies: pluralRequestGenerator("species"),
                getStarship: singularRequestGenerator("starships"),
                getStarships: pluralRequestGenerator("starships"),
                getVehicle: singularRequestGenerator("vehicles"),
                getVehicles: pluralRequestGenerator("vehicles")
            };
        })();

        function searchForPeople() {
            var searchString = document.getElementById('peopleSearch').value;

            swapiModule.getPeople({
                search: searchString
            }, function (data) {
                console.log("All results that match" + searchString, data);
            });
        }

        function searchForShips() {
            var searchString = document.getElementById('shipSearch').value;

            swapiModule.getStarships({
                search: searchString
            }, function (data) {
                console.log("All results that match" + searchString, data);
            });
        }
    </script>
</body>

</html>